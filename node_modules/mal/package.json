{
  "name": "mal",
  "version": "0.4.0",
  "description": "MAL MongoDB Access Layer. A MongoDB wrapper using the native-node-driver",
  "author": {
    "name": "@daithi44"
  },
  "keywords": [
    "mongoDB",
    "mongoDB wrapper",
    "streaming from mongoDB"
  ],
  "repository": {
    "type": "git",
    "url": "https://github.com/daithiw44/MAL"
  },
  "contributors": [
    {
      "name": "David Winders",
      "email": "david.winders@gmail.com"
    }
  ],
  "dependencies": {
    "JSONStream": "0.4.2",
    "mongodb": "1.2.14",
    "request": "2.11.4"
  },
  "engines": {
    "node": ">= 0.8.0"
  },
  "readme": "### MongoDB Wrapper - MAL (MongoDB Access Layer) v0.4.0\n======================================\n\n\n#### Convenience methods for accessing and connecting to, authenticating and querying against a MongoDB instance in Node.\n--------------------------------------------------------------------------------------------\n\n##### What MAL is:\nMal just makes it easier to open, authenicate aconnect to a db. It should make it easier to connect to collections and preform any of the tasks an app would need to perform agaisnt a mongoDB instance.If you database server goes down or is delayed connecting MAL will buffer requests while server connects, reconnections to DB.\n\n#####  What MAL isn't is:\nAt the moment by choice MAL won't directly, (but could ...see univeralMethod below), create your indexes, reIndex it won't drop collections, I normaly have them done before hand or directly in the db, if you really need them\n\n\tMAL.universalMethod('method',arguments);\n\teg. MAL.universalMethod('createIndex',['collection_name',fieldOrSpec, {options}, callback]);\n\tsee example in geo for use of universalMethod instead of ensureIndex.\n\n\n-For node > 0.8.0\n\n#### Examples\n[mal examples](https://github.com/daithiw44/MAL/tree/master/examples)\n\n#### Tests\n[mal tests](https://github.com/daithiw44/MAL/tree/master/tests)\n\n#### MAL\n\nMAL provides an easy way to perform operations on a MongoDB instance.\n[mongodb / node-mongodb-native](https://github.com/mongodb/node-mongodb-native) -- `sits on mongodb / node-mongodb-native function calls\n\n\tAs a general rule function calls take the format of ('collectionname', ...>>> same rules for params as node-mongodb-native);\n\t*exceptions being the two streams calls where the last parameters are always the writebale stream for streamPipe \n\t\tor readable stream for streamEvents.\n\t** no callback if none is desired but set {safe:false} etc.. same as node-mongodb-native.\n\n#### Install\n\nnpm\n--------------------------------\nnpm install mal\n\n\n#### Require\nvar MAL = require('mal').MAL;\n\n#### Create a dbSettings object with Authentication if required.\n--------------------------------\n\texample dbSettings Objects.\n\n\t//Authenticate\n\n\tvar dbsettings = {\n\t\thost: 'host ip or name',\n\t\tport: port number,\n\t\tdb: 'database name',\n\t\toptions: {auto_reconnect: true},\n\t\tusername: '...',\n\t\tpassword: '...'\n\t};\n\n\t//username and password are required only if there is authentication, \n\t//if there is no authentication required remove the properties from the object.\n\n\tvar dbsettings = {\n\t\thost: 'host ip or name',\n\t\tport: port number,\n\t\tdb: 'database name',\n\t\toptions: {auto_reconnect: true}\n\t};\n\n#### Fire it up\n----------------------------------------------------------------\n\nvar dbManager = new MAL(dbsettings, optionalCallback);\n\toptionalCallback is a function that is takes an connected mongoDB server as a parameter.\n\n\tNo CallBack required.\n\t----------------------\n\n\tvar dbManager = new MAL(dbsettings);\n```\n\n\tCallback required\n\t------------------\n\t//example (see test3.js)\n\tvar obj = {\n\t  b: 'connected',\n\t  t: new Date()\n\t};\n\tvar dbManager = new MAL(dbsettings, function(){\n\t  dbManager.insert('Tests', obj, {},function(err,result) {\n\t\tdbManager.find('Tests',{ b: 'connected'},function(err,result1) {\n\t\t  console.log(result1);\n\t\t});\n\t  });\n\t});\n``` \noptionalCallback could also be a function non db related for a example a node process.\n\n\n\tvar dbManager = new MAL(dbsettings, function(){\n\t\thttp.createServer(function (req, res) {\n\t\t  res.writeHead(200, {'Content-Type': 'text/plain'});\n\t\t  res.end('Hello World\\n');\n\t\t}).listen(1337, '127.0.0.1');\n\t\tconsole.log('Server running at http://127.0.0.1:1337/');\n\t});\n\n\n#### Buffers requests if there is no connection established.\n----------------------------------------------------------------\n\nAs of MAL 0.3.0 MAL buffers requests until a connection is establish, and then plays through the requests one the db connection status is 'connected'.\n\nWhere I use buffers is when I have a server whos job it is to speak with a database. Say the database is hosted at Mongolab for example. Typical upNode example a client connects with the server firing in requestsâ€¦\n\n* server goes down\n* upNode client buffers til the server comes back up\n* server comes up but hasn't established a DB connection and the client fires all its buffered requests\n* In that senario all the requests are lost from the client as the server can't act on them as the db connection hasn't been established.\n* MAL takes these requests and buffers them until the connection with Mongolab is etablished and then plays them through.\n\n\n#### Function calls\n--------------------------------\n\nFunction calls to the MAL instance follow the same pattern as node-mongodb-native the exception being \n\tthat all the first paramater is the name of the collection being queried.\n\nThe first parameter is always the collection name, followed by parameters expected by node-mongodb-native\n\n\texample:\n\t\n\t//Assume\n\tvar dbManager = new MAL(dbsettings);\n\tdbManager.find ('col1', {name : 'name'}, {_id:0}, function(err,result){...}); \n\n\t\n#### List of calls available in v0.4\n\tMALinstance.\n\t*find(collectionName, query, fields, options, callback)\n\t*findOne(collectionName, query, callback) \t\n\t*insert(collection_Name, query, options, callback) \n\t*save(collectionName,obj, callback)\n\t*update(collectionName, criteria, update, options, callback) \n\t*remove(collectionName, criteria, callback)\n\t*findAndModify(collection_Name, criteria, sort, update, options, callback)\n\t*findAndRemove(collection_Name, criteria, sort, options, callback)\n\t*ensureIndex(collection_Name, ..as mongodb spec\n\t*count(collection_Name, ..as mongodb spec\n\t*distinct(collection_Name, ..as mongodb spec\n\t//Aggregate Framework.\n\t*aggregate(collection_Name, criteria, criteria....,options,callback);\n\t//geo Stuff\n\t*geoNear(collection_Name, x, y, options, callback);\n\t*geoHaystackSearch(collection_Name, x, y, options, callback);\n\t//MapReduce\n\t*mapReduce(collection_Name, map, reduce, options, callback);\n\t// for Stream methods last parameters must be the writable or readable streams.\n\t*streamPipe(collectionName, query, fields, options, wrStream)\n\t*streamEvents(collectionName, query, fields, options, xStream)\n\n#### Streaming Functionality.\n--------------------------------\n\t\n\tMAL provides two streaming methods. (see examples).\n\t\n\t//Assume\n\tvar dbManager = new MAL(dbsettings);\n\n\t a) streamPipe. (see stream in examples)\n\t \t//function(collectionName, query, fields, options, wrStream) {...\n\t\t// the first argument is always a collectionName\n\t\t// the last\n\t \tdbManager.streamPipe('col1',stream);\n\t\t//this calll will return everything from 'col1' \n\t\t//and pipe the results to wrStream where wrStream is a writable stream like response or a tcp socket.\n\n\t b) streamEvents.( Server side Events from Node/MongoDB... see sse in examples);\n\t \t//lets say we are streaming to serversent events.\n\t\t//pass http response object as stream, or store the response object and pass in the stores response\n\t\tdbManager.streamEvents('Col1',res);\n\t\tres.writeHead(200, {\n\t\t  'Content-Type': 'text/event-stream',\n\t\t  'Cache-Control': 'no-cache',\n\t\t  'Connection': 'keep-alive'\n\t\t});\n\t\t//flush headers\n\t\tres.write('');\n\tc) stream to websockets with .streamPipe\n\t\tsee websockets in examples using shoe and browserify.\n\nsee 'server sent events' example on [cloudfoundry nodejs using a mongolab mongoDB instance](http://mongodbstreamdemo.cloudfoundry.com/)\nstreaming 4.8mb of tweets to the browser with Server Sent Events.\n\nTo populated data, pulled tweets from a twitter account that has volume tweets and stuck them in a mongoDB at mongolab.\n\n5. ToDo.\n--------------------------------\n\n\t1. Write more tests\n\t2. Write examples\n\t3. Replica Sets\n\t4. GridFS\n\n6. Changelog.\n--------------------------------\n\n\t1. v0.3.4 Node server may be up before DBConnection, depending on how MAL is used. MAL will now buffer the db requests while the connection is being established and execut them once the connection is live.\n\t2. v0.3.4 Node changes to streams in v0.10, streams for server sent events are piped.\n\t3. v0.4.0 Aggregate, mapreduce, geoNear, geoHaystackSearch.\n\n\n",
  "readmeFilename": "readme.markdown",
  "bugs": {
    "url": "https://github.com/daithiw44/MAL/issues"
  },
  "homepage": "https://github.com/daithiw44/MAL",
  "_id": "mal@0.4.0",
  "_from": "mal@"
}
